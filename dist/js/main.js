window.onload=function(){var e=new Vue({el:"#main",data:{totalNumOfGamesStartingOffset:14e3,totalNumOfGames:0,ytRegEx:/youtube\.com\/watch\?v=(.+)|youtu\.be\/(.+)/i,twitchRegEx:/twitch\.tv\/\w{3,15}\/v\/(\d+)|twitch.tv\/videos\/(\d+)/i},methods:{getTotalNumOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var n="https://www.speedrun.com/api/v1/games?_bulk=yes&max=1000&offset="+this.totalNumOfGamesStartingOffset;o.open("GET",n),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{t.length<1e3?(e.totalNumOfGames=e.totalNumOfGamesStartingOffset+t.length,e.checkForHash()):(e.totalNumOfGamesStartingOffset+=1e3,e.getTotalNumOfGames())})},checkForHash:function(){window.location.hash||e.getRandomGroupOfGames()},getRandomGroupOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var n="https://www.speedrun.com/api/v1/games?offset="+this.getRandomNumber(this.totalNumOfGames)+"&embed=categories.game";o.open("GET",n),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{e.extractCategoriesFromGroupOfGames(t)})},extractCategoriesFromGroupOfGames:function(t){var o=[].concat.apply([],t.map(e=>e.categories.data));e.removePerLevelCategories(o)},removePerLevelCategories:function(t){var o=t.filter(e=>"per-game"===e.type);e.getRandomSetOfCategories(o)},getRandomSetOfCategories:function(t,o=10){for(var n=[],a=[];n.length<o;){var r=this.getRandomNumber(t.length-1);-1===n.indexOf(r)&&n.push(r)}for(var s=0;s<n.length;s++)a.push(t[n[s]]);e.getRecordsFromCategoryArray(a)},getRecordsFromCategoryArray:function(t){var o=[];t.forEach(t=>o.push(e.getRecordFromCategoryObj(t))),Promise.all(o).then(()=>{console.log("Array Length: "+t.length),console.log(t),t.forEach(function(o){if(o.wr){console.log(o);var n=o.wr.videos.links[0].uri,a=e.getVideoHost(n),r="";a?(console.log("Video URL: "+n),console.log("Video Host: "+a),r=e.getVideoID(n,a),console.log("Video ID: "+r)):t.splice(t.indexOf(o),1)}else t.splice(t.indexOf(o),1)}),console.log("Array Length: "+t.length),console.log(t)})},getRecordFromCategoryObj:function(e){var t=new Promise((t,o)=>{const n=new XMLHttpRequest;var a="https://www.speedrun.com/api/v1/categories/"+e.id+"/records?top=1";n.open("GET",a),n.onload=(()=>t(JSON.parse(n.responseText).data[0])),n.onerror=(()=>o(n.statusText)),n.send()});return t.then(t=>{e.wr=t.runs.length>0&&t.runs[0].run.videos?t.runs[0].run:null}),t},getVideoHost:function(t){return e.ytRegEx.test(t)?"youtube":!!e.twitchRegEx.test(t)&&"twitch"},getVideoID:function(t,o){return id="youtube"===o?e.ytRegEx.exec(t):e.twitchRegEx.exec(t),console.log("Full Match: "+id),console.log("Last item: "+id[id.length-1]),id},getRandomNumber:function(e){return Math.floor(Math.random()*(e+1))}},created:function(){this.getTotalNumOfGames()}})};