window.onload=function(){var e=new Vue({el:"#main",data:{totalNumOfGamesStartingOffset:14e3,totalNumOfGames:0,randomCategories:[],categoriesToCheck:[],viewableCategories:[]},methods:{getTotalNumOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var r="https://www.speedrun.com/api/v1/games?_bulk=yes&max=1000&offset="+this.totalNumOfGamesStartingOffset;o.open("GET",r),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{t.length<1e3?(e.totalNumOfGames=e.totalNumOfGamesStartingOffset+t.length,e.getRandomGroupOfGames()):(e.totalNumOfGamesStartingOffset+=1e3,e.getTotalNumOfGames())})},getRandomGroupOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var r="https://www.speedrun.com/api/v1/games?offset="+this.getRandomNumber(this.totalNumOfGames)+"&embed=categories.game";o.open("GET",r),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{e.extractCategoriesFromGroupOfGames(t)})},extractCategoriesFromGroupOfGames:function(t){var o=[].concat.apply([],t.map(e=>e.categories.data));e.removePerLevelCategories(o)},removePerLevelCategories:function(t){var o=t.filter(e=>"per-game"===e.type);e.getRandomSetOfCategories(o)},getRandomNumber:function(e){return Math.floor(Math.random()*(e+1))},getRandomSetOfCategories:function(t,o=10){for(var r=[],s=[];r.length<o;){var n=this.getRandomNumber(t.length-1);-1===r.indexOf(n)&&r.push(n)}for(var a=0;a<r.length;a++)s.push(t[r[a]]);e.getRecordsFromCategoryArray(s)},getRecordFromCategoryObj:function(t){var o=new Promise((e,o)=>{const r=new XMLHttpRequest;var s="https://www.speedrun.com/api/v1/categories/"+t.id+"/records?top=1";r.open("GET",s),r.onload=(()=>e(JSON.parse(r.responseText).data[0])),r.onerror=(()=>o(r.statusText)),r.send()});return o.then(t=>{e.isRecordViewable(t)}),o},getRecordsFromCategoryArray:function(t){var o=[];t.forEach(t=>o.push(e.getRecordFromCategoryObj(t))),Promise.all(o).then(e=>{console.log(e)})},isRecordViewable:function(t){0!==t.runs.length&&0!==t.runs[0].run.videos&&1===t.runs[0].run.videos.links.length&&e.getVideoHost(t.runs[0].run.videos.links[0].uri)&&(videoInfo={host:e.getVideoHost(t.runs[0].run.videos.links[0].uri),id:e.getVideoID(t.runs[0].run.videos.links[0].uri)},console.log(videoInfo))},getVideoHost:function(e){return host="",e.includes("youtube")||e.includes("youtu.be")?host="youtube":e.includes("twitch")?host="twitch":host=null,host},getVideoID:function(e,t){const o=/twitch\.tv\/videos\/(\d+)|twitch\.tv\/\w{3,15}\/v\/(\d+)/;var r="";return"youtube"===t?r=/youtu\.be\/(.{11})|youtube\.com\/watch\?v=(.{11})/.exec(e):(console.log("test"),r=o.exec(e)[1]),r}},created:function(){this.getTotalNumOfGames()}})};