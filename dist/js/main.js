window.onload=function(){var e=new Vue({el:"#main",data:{totalNumOfGamesStartingOffset:14e3,totalNumOfGames:0,displayedRun:null,backupRuns:[],targetNumOfBackups:3,ytRegEx:/(?:(?:youtube\.com\/watch\?v=)|(?:youtu\.be\/))(.+)/i,twitchRegEx:/(?:twitch\.tv\/(?:\w{3,15}\/v\/)|(?:videos\/))(\d+)/i},computed:{isButtonDisabled:function(){return!this.displayedRun},wrInfo:function(){return{gameTitle:this.displayedRun.gameTitle,categoryName:this.displayedRun.categoryName,formattedRuntime:this.displayedRun.formattedRuntime,timingMethod:this.displayedRun.timingMethod,src:this.displayedRun.src}},videoInfo:function(){return{host:this.displayedRun.videoHost,id:this.displayedRun.videoID}}},methods:{getTotalNumOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var a="https://www.speedrun.com/api/v1/games?_bulk=yes&max=1000&offset="+this.totalNumOfGamesStartingOffset;o.open("GET",a),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{t.length<1e3?(e.totalNumOfGames=e.totalNumOfGamesStartingOffset+t.length,e.checkForHash()):(e.totalNumOfGamesStartingOffset+=1e3,e.getTotalNumOfGames())})},checkForHash:function(){window.location.hash||e.getRandomGroupOfGames()},getRandomGroupOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var a="https://www.speedrun.com/api/v1/games?offset="+this.getRandomNumber(this.totalNumOfGames)+"&embed=categories.game";o.open("GET",a),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{e.extractCategories(t)})},extractCategories:function(t){var o=[].concat.apply([],t.map(e=>e.categories.data));0===(o=o.filter(e=>"per-game"===e.type)).length?e.getRandomGroupOfGames():e.getRandomSetOfCategories(o)},getRandomSetOfCategories:function(t,o=10){var a=[],n=[];for(t.length<o&&(o=t.length);a.length<o;){var r=this.getRandomNumber(t.length-1);-1===a.indexOf(r)&&a.push(r)}a.forEach(e=>{n.push(t[e])}),e.getRecordsFromCategoryArray(n)},getRecordsFromCategoryArray:function(t){var o=[];t.forEach(t=>o.push(e.getRecordFromCategoryObj(t))),Promise.all(o).then(()=>{0===(t=t.filter(e=>e.wr)).length?e.getRandomGroupOfGames():e.parseVideoInfo(t)})},getRecordFromCategoryObj:function(e){var t=new Promise((t,o)=>{const a=new XMLHttpRequest;var n="https://www.speedrun.com/api/v1/categories/"+e.id+"/records?top=1";a.open("GET",n),a.onload=(()=>t(JSON.parse(a.responseText).data[0])),a.onerror=(()=>o(a.statusText)),a.send()});return t.then(t=>{e.wr=t.runs.length>0&&t.runs[0].run.videos?t.runs[0].run:null}),t},parseVideoInfo:function(t){t.forEach(t=>t.videoHost=e.ytRegEx.test(t.wr.videos.links[0].uri)?"youtube":!!e.twitchRegEx.test(t.wr.videos.links[0].uri)&&"twitch"),0===(t=t.filter(e=>e.videoHost)).length?e.getRandomGroupOfGames():(t.forEach(t=>t.videoID="youtube"===t.videoHost?e.ytRegEx.exec(t.wr.videos.links[0].uri)[1]:e.twitchRegEx.exec(t.wr.videos.links[0].uri)[1]),e.cleanCategoryObject(t[e.getRandomNumber(t.length-1)]))},cleanCategoryObject:function(t){var o={};o.gameID=t.game.data.id,o.gameTitle=t.game.data.names.international?t.game.data.names.international:t.game.data.names.japanese,o.categoryID=t.id,o.categoryName=t.name,t.wr.times.primary_t===t.wr.times.ingame_t?(o.timingMethod="IGT",o.runtime=t.wr.times.ingame_t):t.wr.times.primary_t===t.wr.times.realtime_t?(o.timingMethod="RTA",o.runtime=t.wr.times.realtime_t):(o.timingMethod="RTA (No Loads)",o.runtime=t.wr.times.realtime_noloads_t),o.formattedRuntime=e.formatRuntime(o.runtime),o.src=t.weblink,o.videoHost=t.videoHost,o.videoID=t.videoID,o.players=t.wr.players,e.getAllPlayersInfo(o)},getAllPlayersInfo:function(t){var o=[];t.players.forEach(t=>o.push("guest"!==t.rel?e.getPlayerInfo(t):t)),Promise.all(o).then(()=>{null===e.displayedRun?e.displayedRun=t:e.backupRuns.push(t),e.backupRuns.length<e.targetNumOfBackups&&e.getRandomGroupOfGames()})},getPlayerInfo:function(e){var t=new Promise((t,o)=>{const a=new XMLHttpRequest;var n=e.uri;a.open("GET",n),a.onload=(()=>t(JSON.parse(a.responseText).data)),a.onerror=(()=>o(a.statusText)),a.send()});return t.then(t=>{e.name=t.names.japanese?t.names.japanese:t.names.international,e.src=t.weblink,e.twitch=t.twitch?t.twitch.uri:null,e.twitter=t.twitter?t.twitter.uri:null,e.youtube=t.youtube?t.youtube.uri:null}),t},getNextRun:function(){e.displayedRun=null,e.backupRuns.length>0&&(e.displayedRun=e.backupRuns.shift(),e.backupRuns.length===e.targetNumOfBackups-1&&e.getRandomGroupOfGames())},getRandomNumber:function(e){return Math.floor(Math.random()*(e+1))},formatRuntime:function(e){var t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),a=e-3600*t-60*o;return t<10&&(t="0"+t),o<10&&(o="0"+o),a%1!=0&&(a=a.toFixed(3)),a<10&&(a="0"+a),t+":"+o+":"+a}},created:function(){this.getTotalNumOfGames()}})},Vue.component("player-info",{props:["player"],computed:{isUser:function(){return"guest"!==this.player.rel}},template:' <div>                    <a v-if="isUser" :href="player.src"><h3>{{ player.name }}</h3></a>                    <h3 v-else>{{ player.name }}</h3>                                        <a v-if="player.twitch" :href="player.twitch"><p>Twitch</p></a>                    <p v-else>No Twitch</p>                                        <a v-if="player.youtube" :href="player.youtube"><p>YouTube</p></a>                    <p v-else>No YouTube</p>                                        <a v-if="player.twitter" :href="player.twitter"><p>Twitter</p></a>                    <p v-else>No Twitter</p>                </div>'}),Vue.component("players-info",{props:["players"],template:' <section class="l-players-info">                    <player-info v-for="player in players" :player="player" :key="player.id"></player-info>                </section>'}),Vue.component("video-embed",{props:["video-info"],computed:{isYtEmbed:function(){return"youtube"===this.videoInfo.host},videoURL:function(){return"youtube"===this.videoInfo.host?"https://www.youtube.com/embed/"+this.videoInfo.id:"https://player.twitch.tv/?video=v"+this.videoInfo.id}},template:'<section class="video-embed">                    <iframe v-if="isYtEmbed" :src="videoURL"                    frameborder="0"                    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"                    allowfullscreen></iframe>                                        <iframe v-else :src="videoURL"                    frameborder="0"                    scrolling="no"                    allowfullscreen="true"                    </iframe>                </section>'}),Vue.component("wr-button",{props:["isButtonDisabled"],methods:{emitButtonClicked:function(){this.$emit("button-clicked")}},template:' <section class="l-wr-button">                    <button type="button" :disabled="isButtonDisabled" @click="emitButtonClicked">                        <p>Get WR</p>                    </button>                </section>'}),Vue.component("wr-info",{props:["wr-info"],template:'<section class="wr-info">                    <h2><a :href="wrInfo.src">{{ wrInfo.gameTitle }} - {{ wrInfo.categoryName }}</a> in {{ wrInfo.formattedRuntime }} ({{ wrInfo.timingMethod }})</h2>                </section>'});