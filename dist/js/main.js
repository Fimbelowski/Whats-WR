window.onload=function(){var e=new Vue({el:"#main",data:{totalNumOfGamesStartingOffset:15e3,totalNumOfGames:0,displayedRun:null,backupRuns:[],targetNumOfBackups:3,idleTimeoutDuration:15,pageIsIdle:!1,ytRegEx:/(?:(?:youtube\.com\/watch\?v=)|(?:youtu\.be\/))(.+)/i,twitchRegEx:/(?:twitch\.tv\/(?:\w{3,15}\/v\/)|(?:videos\/))(\d+)/i},computed:{wrInfo:function(){return{gameTitle:this.displayedRun.gameTitle,categoryName:this.displayedRun.categoryName,runtime:this.displayedRun.runtime,timingMethod:this.displayedRun.timingMethod,src:this.displayedRun.src,runID:this.displayedRun.runID}}},methods:{getTotalNumOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var a="https://www.speedrun.com/api/v1/games?_bulk=yes&max=1000&offset="+this.totalNumOfGamesStartingOffset;o.open("GET",a),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{t.length<1e3?(e.totalNumOfGames=e.totalNumOfGamesStartingOffset+t.length,e.findRuns()):(e.totalNumOfGamesStartingOffset+=1e3,e.getTotalNumOfGames())}).catch(t=>{window.setTimeout(function(){e.getTotalNumOfGames()},1e3)})},findRuns:function(){var t=e.targetNumOfBackups;e.displayedRun||t++;for(var o=0;o<t;o++)e.getRandomGroupOfGames()},getRandomGroupOfGames:function(){new Promise((e,t)=>{const o=new XMLHttpRequest;var a="https://www.speedrun.com/api/v1/games?offset="+this.getRandomNumber(this.totalNumOfGames-19)+"&embed=categories.game";o.open("GET",a),o.onload=(()=>e(JSON.parse(o.responseText).data)),o.onerror=(()=>t(o.statusText)),o.send()}).then(t=>{e.extractCategories(t)}).catch(t=>{window.setTimeout(function(){e.getRandomGroupOfGames()},1e3)})},extractCategories:function(t){var o=[].concat.apply([],t.map(e=>e.categories.data));(o=o.filter(e=>"per-game"===e.type)).length?e.getRandomSetOfCategories(o):e.getRandomGroupOfGames()},getRandomSetOfCategories:function(t,o=10){var a=[],n=[];for(t.length<o&&(o=t.length);a.length<o;){var i=this.getRandomNumber(t.length-1);-1===a.indexOf(i)&&a.push(i)}a.forEach(e=>{n.push(t[e])}),e.getRecordsFromCategoryArray(n)},getRecordsFromCategoryArray:function(t){var o=[];t.forEach(t=>o.push(e.getRecordFromCategoryObj(t))),Promise.all(o).then(()=>{(t=t.filter(e=>e.wr)).length?e.checkVideoHosts(t):e.getRandomGroupOfGames()})},getRecordFromCategoryObj:function(t){var o=new Promise((e,o)=>{const a=new XMLHttpRequest;var n="https://www.speedrun.com/api/v1/categories/"+t.id+"/records?top=1";a.open("GET",n),a.onload=(()=>e(JSON.parse(a.responseText).data[0])),a.onerror=(()=>o(a.statusText)),a.send()});return o.then(e=>{t.wr=e.runs.length>0&&e.runs[0].run.videos?e.runs[0].run:null}).catch(o=>{window.setTimeout(function(){e.getRecordFromCategoryObj(t)},1e3)}),o},checkVideoHosts:function(t){t.forEach(t=>t.videoHost=e.ytRegEx.test(t.wr.videos.links[0].uri)?"youtube":e.twitchRegEx.test(t.wr.videos.links[0].uri)?"twitch":null),(t=t.filter(e=>e.videoHost)).length?e.cleanCategoryObject(t[e.getRandomNumber(t.length-1)]):e.getRandomGroupOfGames()},cleanCategoryObject:function(t){var o={};o.gameID=t.game.data.id,o.gameTitle=t.game.data.names.international?t.game.data.names.international:t.game.data.names.japanese,o.categoryID=t.id,o.categoryName=t.name,o.runID=t.wr.id,e.parseTimingInfo(o,t.wr),o.src=t.weblink,o.videoURL=t.wr.videos.links[0].uri,o.players=t.wr.players,e.getAllPlayersInfo(o)},parseTimingInfo:function(e,t){t.times.primary_t===t.times.ingame_t?(e.timingMethod="IGT",e.runtime=t.times.ingame_t):t.times.primary_t===t.times.realtime_t?(e.timingMethod="RTA",e.runtime=t.times.realtime_t):(e.timingMethod="RTA (No Loads)",e.runtime=t.times.realtime_noloads_t)},getAllPlayersInfo:function(t){var o=[];t.players.forEach(t=>o.push(e.getPlayerInfo(t))),Promise.all(o).then(()=>{null===e.displayedRun?(e.displayedRun=t,window.location.hash=encodeURIComponent(e.displayedRun.runID),e.pageIsIdle=!1):e.backupRuns.push(t)})},getPlayerInfo:function(t){var o=new Promise((e,o)=>{if("guest"===t.rel)e(t);else{const n=new XMLHttpRequest;var a=t.uri;n.open("GET",a),n.onload=(()=>e(JSON.parse(n.responseText).data)),n.onerror=(()=>o(n.statusText)),n.send()}});return o.then(o=>{e.parsePlayerInfo(t,o)}).catch(o=>{window.setTimeout(function(){e.getPlayerInfo(t)},1e3)}),o},parsePlayerInfo:function(e,t){e.name="guest"===t.rel?t.name:t.names.japanese?t.names.japanese:t.names.international,e.src=t.weblink?t.weblink:null,e.twitch=t.twitch?t.twitch.uri:null,e.twitter=t.twitter?t.twitter.uri:null,e.youtube=t.youtube?t.youtube.uri:null},getNextRun:function(){e.displayedRun=null,e.backupRuns.length?(e.displayedRun=e.backupRuns.shift(),window.location.hash=encodeURIComponent(e.displayedRun.runID),e.getRandomGroupOfGames()):e.startIdleTimeout(e.idleTimeoutDuration)},getRunFromHash:function(){var t=decodeURIComponent(window.location.hash).slice(1),o=new Promise((e,o)=>{const a=new XMLHttpRequest;var n="https://www.speedrun.com/api/v1/runs/"+t+"?embed=game,category,players";a.open("GET",n),a.onload=(()=>e(JSON.parse(a.responseText).data)),a.onerror=(()=>o(a.statusText)),a.send()});return o.then(t=>{e.pageIsIdle=!1,e.parseRunFromHash(t)}).catch(t=>{window.setTimeout(function(){e.getRunFromHash()},1e3)}),o},parseRunFromHash:function(t){var o={};o.gameID=t.game.data.id,o.gameTitle=t.game.data.names.international?t.game.data.names.international:t.game.data.names.japanese,o.categoryID=t.category.data.id,o.categoryName=t.category.data.name,o.runID=t.id,e.parseTimingInfo(o,t),o.src=t.category.data.weblink,o.videoURL=t.videos.links[0].uri,o.players=[],t.players.data.forEach((t,a)=>{o.players.push({}),e.parsePlayerInfo(o.players[a],t)}),e.displayedRun=o,e.getTotalNumOfGames()},getRandomNumber:function(e){return Math.floor(Math.random()*(e+1))},startIdleTimeout:function(t){setTimeout(function(){e.displayedRun||(e.pageIsIdle=!0)},1e3*t)}},created:function(){window.location.hash?this.getRunFromHash():this.getTotalNumOfGames(),this.startIdleTimeout(this.idleTimeoutDuration)}})},Vue.component("player-info-container",{props:["players"],computed:{playersHeader:function(){return 1===this.players.length?"Runner":"Runners"}},template:' <section class="player-info-container">                    <div class="player-info-container-header">                        <h3 class="player-text">{{ playersHeader }}</h3>                    </div>                    <player-info v-for="player in players" :player="player" :key="player.id"></player-info>                </section>'}),Vue.component("player-info",{props:["player"],computed:{hasSocial:function(){return this.player.twitch||this.player.youtube||this.player.twitter}},template:' <div class="player-info">                    <a v-if="player.src" :href="player.src"><h3 class="player-text">{{ player.name }}</h3></a>                    <h3 v-else class="player-text">{{ player.name }}</h3>                    <div v-if="hasSocial" class="player-social-container">                        <a v-if="player.twitch" :href="player.twitch"><img src="/dist/images/Glitch_White_RGB.png" class="player-social-icon"></a>                                                <a v-if="player.youtube" :href="player.youtube"><img src="/dist/images/yt_icon_mono_dark.png" class="player-social-icon"></a>                                                <a v-if="player.twitter" :href="player.twitter"><img src="/dist/images/Twitter_Logo_White.png" class="player-social-icon"></a>                    </div>                </div>'}),Vue.component("video-embed",{props:["video-url"],data:function(){return{ytRegEx:/(?:(?:youtube\.com\/watch\?v=)|(?:youtu\.be\/))(.+)/i,twitchRegEx:/(?:twitch\.tv\/(?:\w{3,15}\/v\/)|(?:videos\/))(\d+)/i}},computed:{videoHost:function(){return this.ytRegEx.test(this.videoUrl)?"youtube":"twitch"},videoID:function(){return"youtube"===this.videoHost?this.ytRegEx.exec(this.videoUrl)[1].replace(/&/,"?").replace(/t=/,"start="):this.twitchRegEx.exec(this.videoUrl)[1]},videoURL:function(){var e="";return"youtube"===this.videoHost?(e="https://www.youtube.com/embed/"+this.videoID,this.videoID.includes("?")?e+="&autoplay=1":e+="?autoplay=1"):e="https://player.twitch.tv/?video=v"+this.videoID,e}},template:' <section class="video-embed-container">                    <iframe v-if="videoHost === \'youtube\'" class="video-embed" :src="videoURL"                    frameborder="0"                    allow="accelerometer; encrypted-media; gyroscope; picture-in-picture"                    allowfullscreen="true"></iframe>                                        <iframe v-else class="video-embed" :src="videoURL"                    frameborder="0"                    scrolling="no"                    allowfullscreen="true">                    </iframe>                </section>'}),Vue.component("wr-button",{props:["isButtonDisabled"],methods:{emitButtonClicked:function(){this.$emit("button-clicked")}},template:' <section class="wr-button-container">                    <button type="button" :disabled="isButtonDisabled" @click="emitButtonClicked" class="wr-button">                        <h1 class="wr-button-text">What\'s WR?</h1>                    </button>                </section>'}),Vue.component("wr-info",{props:["wr-info"],data:function(){return{urlToCopy:!1,showTooltip:!1,tooltipClicked:!1}},computed:{formattedRuntime:function(){var e=this.wrInfo.runtime,t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),a=e-3600*t-60*o;return t<10&&(t="0"+t),o<10&&(o="0"+o),a%1!=0&&(a=a.toFixed(3)),a<10&&(a="0"+a),t+":"+o+":"+a},windowLocationHref:function(){return window.location.hostname+":"+window.location.port+"/#"+this.wrInfo.runID},tooltipMessage:function(){return this.tooltipClicked?"URL Copied!":"Click here to copy the current run to your clipboard!"},tooltipContainerStyleObj:function(){return{width:this.tooltipClicked?"80px":"320px",marginLeft:this.tooltipClicked?"-40px":"-160px"}}},methods:{copyURLToClipboard:function(){this.urlToCopy=!0,this.$refs.urlTextArea.select(),document.execCommand("copy"),this.urlToCopy=!1}},template:'<section class="wr-info-container">                    <h2 class="wr-info-text"><a :href="wrInfo.src">{{ wrInfo.gameTitle }} - {{ wrInfo.categoryName }}</a> in {{  formattedRuntime }} ({{ wrInfo.timingMethod }})</h2>                    <div class="tooltip" @mouseenter="showTooltip = true" @mouseleave="showTooltip = false; tooltipClicked = false" @click="tooltipClicked = true">                        <img class="copy-url-button" src="dist/images/link.png" @click="copyURLToClipboard">                        <div class="tooltip-container" :style="tooltipContainerStyleObj" v-if="showTooltip">                            <p>{{ tooltipMessage }}</p>                        </div>                    </div>                    <textarea ref="urlTextArea" class="url-text-area">{{ windowLocationHref }}</textarea>                </section>'});